{
  "test_configuration": {
    "environments": {
      "development": {
        "api_base": "http://localhost:8000",
        "dashboard_base": "http://localhost:8501",
        "prometheus_base": "http://localhost:9090",
        "grafana_base": "http://localhost:3000",
        "test_timeout": 300,
        "parallel_execution": false,
        "cleanup_after_tests": true
      },
      "staging": {
        "api_base": "https://staging-api.yourdomain.com",
        "dashboard_base": "https://staging-dashboard.yourdomain.com",
        "prometheus_base": "https://staging-prometheus.yourdomain.com",
        "grafana_base": "https://staging-grafana.yourdomain.com",
        "test_timeout": 600,
        "parallel_execution": true,
        "cleanup_after_tests": true
      },
      "production": {
        "api_base": "https://api.yourdomain.com",
        "dashboard_base": "https://dashboard.yourdomain.com",
        "prometheus_base": "https://prometheus.yourdomain.com",
        "grafana_base": "https://grafana.yourdomain.com",
        "test_timeout": 900,
        "parallel_execution": true,
        "cleanup_after_tests": true,
        "safety_checks": true
      }
    },
    "test_data": {
      "sample_users": [
        {
          "wa_id": "test_user_1",
          "name": "João Silva",
          "email": "joao.silva@test.com",
          "phone": "+5511987654321"
        },
        {
          "wa_id": "test_user_2", 
          "name": "Maria Santos",
          "email": "maria.santos@test.com",
          "phone": "+5511876543210"
        }
      ],
      "sample_messages": [
        {
          "type": "greeting",
          "content": "Olá!",
          "expected_keywords": ["olá", "bem-vindo", "posso ajudar"]
        },
        {
          "type": "appointment_request",
          "content": "Gostaria de agendar um horário",
          "expected_keywords": ["agendamento", "horário", "disponível"]
        },
        {
          "type": "service_inquiry",
          "content": "Quais serviços vocês oferecem?",
          "expected_keywords": ["serviços", "oferecemos", "especialidades"]
        },
        {
          "type": "pricing",
          "content": "Quanto custa um corte de cabelo?",
          "expected_keywords": ["preço", "valor", "custa"]
        }
      ],
      "sample_appointments": [
        {
          "service": "Corte de Cabelo",
          "duration": 60,
          "price": "50.00"
        },
        {
          "service": "Corte e Barba",
          "duration": 90,
          "price": "75.00"
        }
      ]
    },
    "test_scenarios": {
      "conversation_flows": [
        {
          "name": "Complete Appointment Booking",
          "description": "Fluxo completo de agendamento via WhatsApp",
          "steps": [
            {
              "message": "Olá!",
              "expected_response_type": "greeting"
            },
            {
              "message": "Gostaria de agendar um horário",
              "expected_response_type": "appointment_inquiry"
            },
            {
              "message": "João Silva",
              "expected_response_type": "data_collection"
            },
            {
              "message": "joao@email.com",
              "expected_response_type": "data_collection"
            },
            {
              "message": "11987654321",
              "expected_response_type": "service_selection"
            },
            {
              "message": "Corte de cabelo",
              "expected_response_type": "time_selection"
            },
            {
              "message": "Amanhã às 14h",
              "expected_response_type": "confirmation"
            }
          ]
        },
        {
          "name": "Service Information",
          "description": "Consulta sobre serviços disponíveis",
          "steps": [
            {
              "message": "Oi, bom dia!",
              "expected_response_type": "greeting"
            },
            {
              "message": "Quais serviços vocês fazem?",
              "expected_response_type": "service_list"
            },
            {
              "message": "Quanto custa cada um?",
              "expected_response_type": "pricing_info"
            }
          ]
        },
        {
          "name": "Appointment Cancellation",
          "description": "Cancelamento de agendamento existente",
          "steps": [
            {
              "message": "Preciso cancelar meu agendamento",
              "expected_response_type": "cancellation_inquiry"
            },
            {
              "message": "Sim, confirmo o cancelamento",
              "expected_response_type": "cancellation_confirmation"
            }
          ]
        }
      ],
      "load_tests": {
        "concurrent_users": 50,
        "messages_per_user": 10,
        "test_duration_minutes": 5,
        "ramp_up_time_seconds": 60
      },
      "stress_tests": {
        "max_concurrent_users": 100,
        "database_operations_per_second": 1000,
        "api_requests_per_second": 500
      }
    },
    "validation_rules": {
      "response_time_limits": {
        "api_endpoints": 2000,
        "database_queries": 1000,
        "whatsapp_webhook": 5000,
        "llm_response": 10000
      },
      "success_rate_thresholds": {
        "api_calls": 95,
        "message_processing": 90,
        "appointment_creation": 85,
        "data_collection": 80
      },
      "required_health_checks": [
        "database_connectivity",
        "redis_connectivity",
        "external_apis",
        "file_system_access",
        "memory_usage",
        "cpu_usage"
      ]
    },
    "monitoring_checks": {
      "prometheus_metrics": [
        "http_requests_total",
        "http_request_duration_seconds",
        "whatsapp_messages_processed_total",
        "appointments_created_total",
        "database_connections_active",
        "redis_operations_total"
      ],
      "log_patterns": [
        "ERROR",
        "CRITICAL",
        "EXCEPTION",
        "TIMEOUT",
        "CONNECTION_FAILED"
      ],
      "alert_conditions": [
        {
          "metric": "error_rate",
          "threshold": 5,
          "window_minutes": 5
        },
        {
          "metric": "response_time_p95",
          "threshold": 5000,
          "window_minutes": 10
        }
      ]
    }
  },
  "setup_instructions": {
    "prerequisites": [
      "Python 3.8+",
      "Docker e Docker Compose",
      "PostgreSQL client (psql)",
      "Redis client (redis-cli)",
      "curl para testes HTTP"
    ],
    "environment_setup": {
      "development": [
        "1. Clone o repositório do projeto",
        "2. Copie .env.example para .env.development",
        "3. Configure as variáveis de ambiente necessárias",
        "4. Execute: docker-compose up -d",
        "5. Aguarde todos os serviços iniciarem (2-3 minutos)",
        "6. Execute: python3 -m venv venv && source venv/bin/activate",
        "7. Execute: pip install -r requirements.txt requirements-test.txt"
      ],
      "production": [
        "1. Certifique-se de que todos os serviços estão rodando",
        "2. Configure .env.production com credenciais reais",
        "3. Execute backup do banco antes dos testes",
        "4. Notifique a equipe sobre execução dos testes",
        "5. Configure monitoramento adicional se necessário"
      ]
    },
    "execution_steps": [
      {
        "step": "1. Preparação",
        "commands": [
          "cd /path/to/whatsapp-agent",
          "chmod +x run_complete_tests.sh",
          "source venv/bin/activate"
        ]
      },
      {
        "step": "2. Verificação rápida",
        "commands": [
          "./run_complete_tests.sh --environment development",
          "# Verifica se ambiente básico está funcionando"
        ]
      },
      {
        "step": "3. Testes específicos",
        "commands": [
          "python3 whatsapp_message_tester.py --test-conversations",
          "python3 whatsapp_message_tester.py --test-appointments",
          "python3 complete_test_suite.py --env development"
        ]
      },
      {
        "step": "4. Testes completos",
        "commands": [
          "./run_complete_tests.sh --environment staging --with-load",
          "# Executa suite completa incluindo testes de carga"
        ]
      },
      {
        "step": "5. Validação de produção",
        "commands": [
          "./run_complete_tests.sh --environment production",
          "# CUIDADO: Use apenas em horários de baixo tráfego"
        ]
      }
    ]
  },
  "troubleshooting": {
    "common_issues": [
      {
        "problem": "Containers não iniciam",
        "solution": "Verifique se as portas 5432, 6379, 8000, 8501 estão livres",
        "commands": [
          "docker-compose down",
          "docker system prune -f",
          "docker-compose up -d --force-recreate"
        ]
      },
      {
        "problem": "Testes de banco falham",
        "solution": "Verifique credenciais e conectividade",
        "commands": [
          "psql -h localhost -U $DB_USER -d $DB_NAME -c 'SELECT 1;'",
          "docker-compose logs postgres"
        ]
      },
      {
        "problem": "WhatsApp webhook não responde",
        "solution": "Verifique configuração do ngrok e tokens",
        "commands": [
          "curl -X GET 'http://localhost:8000/webhook?hub.mode=subscribe&hub.verify_token=YOUR_TOKEN&hub.challenge=test'",
          "tail -f logs/app/webhook.log"
        ]
      },
      {
        "problem": "Testes de carga falham",
        "solution": "Reduza número de usuários concorrentes",
        "commands": [
          "# Edite test_configuration para valores menores",
          "# Monitore uso de CPU e memória durante execução"
        ]
      }
    ],
    "log_locations": {
      "application_logs": "logs/app/",
      "test_logs": "logs/tests/",
      "docker_logs": "docker-compose logs [service_name]",
      "database_logs": "docker-compose logs postgres",
      "nginx_logs": "logs/nginx/"
    },
    "debug_commands": [
      {
        "description": "Verificar status dos containers",
        "command": "docker-compose ps"
      },
      {
        "description": "Verificar logs da aplicação",
        "command": "docker-compose logs app --tail=50"
      },
      {
        "description": "Verificar conectividade do banco",
        "command": "docker-compose exec postgres psql -U $DB_USER -d $DB_NAME -c '\\l'"
      },
      {
        "description": "Verificar Redis",
        "command": "docker-compose exec redis redis-cli ping"
      },
      {
        "description": "Verificar endpoints da API",
        "command": "curl -s http://localhost:8000/health | jq"
      },
      {
        "description": "Verificar métricas",
        "command": "curl -s http://localhost:8000/metrics | grep -E '^(http_requests|whatsapp_messages)'"
      }
    ]
  },
  "reporting": {
    "output_formats": [
      "JSON detalhado",
      "Markdown para documentação",
      "HTML para visualização web",
      "CSV para análise em planilhas"
    ],
    "report_sections": [
      "Resumo executivo",
      "Status por componente",
      "Testes falhados com detalhes",
      "Métricas de performance",
      "Recomendações de correção",
      "Logs relevantes",
      "Gráficos de tendências"
    ],
    "automated_alerts": {
      "slack_webhook": "CONFIGURE_SLACK_WEBHOOK_URL",
      "email_recipients": ["admin@yourdomain.com"],
      "alert_thresholds": {
        "failure_rate": 10,
        "response_time_degradation": 50
      }
    }
  },
  "security_considerations": {
    "production_safety": [
      "Execute testes apenas em horários de baixo tráfego",
      "Faça backup completo antes de executar",
      "Configure rate limiting para testes",
      "Monitore impacto nos recursos do sistema",
      "Tenha plano de rollback preparado"
    ],
    "data_protection": [
      "Use dados sintéticos para testes",
      "Não use informações reais de clientes",
      "Limpe dados de teste após execução",
      "Criptografe logs que contenham dados sensíveis"
    ],
    "access_control": [
      "Limite execução a usuários autorizados",
      "Use variáveis de ambiente para credenciais",
      "Não commite credenciais no repositório",
      "Rotacione tokens após testes em produção"
    ]
  }
}