
# Configuração adicional para PostgreSQL com SSL
# Adicione estas linhas ao seu docker-compose.yml na seção do postgres:


    # 🔐 CONFIGURAÇÕES SSL ADICIONADAS
    environment:
      POSTGRES_DB: ${DB_NAME:-whatsapp_agent}
      POSTGRES_USER: ${DB_USER:-vancimj}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-change_this_password}
      PGDATA: /var/lib/postgresql/data/pgdata
      # SSL Configuration
      POSTGRES_SSL_CERT_FILE: /var/lib/postgresql/ssl/server.crt
      POSTGRES_SSL_KEY_FILE: /var/lib/postgresql/ssl/server.key
      POSTGRES_SSL_CA_FILE: /var/lib/postgresql/ssl/root.crt
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backups/database:/backups
      - ./config/postgres/ssl:/var/lib/postgresql/ssl:ro
      - ./config/postgres/postgresql_ssl.conf:/var/lib/postgresql/postgresql_ssl.conf:ro
      - ./config/postgres/pg_hba.conf:/var/lib/postgresql/pg_hba.conf:ro
    command: >
      postgres
      -c ssl=on
      -c ssl_cert_file=/var/lib/postgresql/ssl/server.crt
      -c ssl_key_file=/var/lib/postgresql/ssl/server.key
      -c ssl_ca_file=/var/lib/postgresql/ssl/root.crt
      -c config_file=/var/lib/postgresql/postgresql_ssl.conf
      -c hba_file=/var/lib/postgresql/pg_hba.conf
      -c shared_preload_libraries=pg_stat_statements
      -c log_statement=mod
      -c log_connections=on
      -c log_disconnections=on
      -c password_encryption=scram-sha-256

